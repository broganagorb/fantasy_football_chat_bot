name: ESPN Discord Bot

on:
  schedule:
    # UTC times (comments show Central Time)
    - cron: '30 15 * * 2'   # Tue 10:30 AM CT
    - cron: '00 23 * * 4'   # Thu 6:00 PM CT
    - cron: '30 17 * * 0'   # Sun 12:30 PM CT
    - cron: '30 03 * * 1'   # Mon 10:30 PM CT
  workflow_dispatch: {}

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install -U pip
          python -m pip install apscheduler requests espn_api DateTime

      - name: Run ESPN bot once
        run: |
          python - <<'PY'
from gamedaybot.espn import espn_bot
espn_bot.espn_bot("init")
PY
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          LEAGUE_ID:           ${{ secrets.LEAGUE_ID }}
          LEAGUE_YEAR:         ${{ secrets.LEAGUE_YEAR }}
          TIMEZONE:            ${{ secrets.TIMEZONE }}
          ESPN_S2:             ${{ secrets.ESPN_S2 }}
          SWID:                ${{ secrets.SWID }}
          START_DATE:          ${{ secrets.START_DATE }}
          END_DATE:            ${{ secrets.END_DATE }}
